# 编辑器 (Vim)



---

**Resources：**

[编辑器 (Vim) · the missing semester of your cs education](https://missing-semester-cn.github.io/2020/editors/)





---



写作和写代码其实是两项非常不同的活动。当我们编程的时候，会经常在文件间进行切换、阅读、浏览和修改代码，而不是连续编写一大段的文字。因此代码编辑器和文本编辑器是很不同的两种工具（例如微软的 Word 与 Visual Studio Code）。

作为程序员，我们大部分时间都花在代码编辑上，所以花点时间掌握某个适合自己的编辑器是非常值得的。通常学习使用一个新的编辑器包含以下步骤：

- 阅读教程（比如这节课以及我们为您提供的资源）
- 坚持使用它来完成你所有的编辑工作（即使一开始这会让你的工作效率降低）
- 随时查阅：如果某个操作看起来像是有更方便的实现方法，一般情况下真的会有

如果您能够遵循上述步骤，并且坚持使用新的编辑器完成您所有的文本编辑任务，那么学习一个复杂的代码编辑器的过程一般是这样的：头两个小时，您会学习到编辑器的基本操作，例如打开和编辑文件、保存与退出、浏览缓冲区。当学习时间累计达到 20 个小时之后，您使用新编辑器的效率应该已经和使用老编辑器一样快。在此之后，其益处开始显现：有了足够的知识和肌肉记忆后，使用新编辑器将大大节省你的时间。而现代文本编辑器都是些复杂且强大的工具，永远有新东西可学：学的越多，效率越高。



## Vim的设计哲学

在编程的时候，你会把大量时间花在阅读/编辑而不是在写代码上。所以，Vim 是一个 **多模态** 编辑 器：它对于插入文字和操纵文字有不同的模式。Vim 是可编程的（可以使用 Vimscript 或者像 Python 一样的其他程序语言），Vim 的接口本身也是一个程序语言：键入操作（以及其助记名） 是命令，这些命令也是可组合的。Vim 避免了使用鼠标，因为那样太慢了；Vim 甚至避免用 上下左右键因为那样需要太多的手指移动。

这样的设计哲学使得 Vim 成为了一个能跟上你思维速度的编辑器。

## 编辑模式

Vim 的设计以大多数时间都花在阅读、浏览和进行少量编辑改动为基础，因此它具有多种操作模式：

- **正常模式**：在文件中四处移动光标进行修改
- **插入模式**：插入文本
- **替换模式**：替换文本
- **可视化模式**（一般，行，块）：选中文本块
- **命令模式**：用于执行命令

在不同的操作模式下，键盘敲击的含义也不同。比如，`x` 在插入模式会插入字母 `x`，但是在正常模式 会删除当前光标所在的字母，在可视模式下则会删除选中文块。

在默认设置下，Vim 会在左下角显示当前的模式。Vim 启动时的默认模式是正常模式。通常你会把大部分时间花在**正常模式**和**插入模式**。

你可以按下 `<ESC>`（退出键）从任何其他模式返回正常模式。在正常模式，键入 `i` 进入插入 模式，`R` 进入替换模式，`v` 进入可视（一般）模式，`V` 进入可视（行）模式，`<C-v>` （Ctrl-V, 有时也写作 `^V`）进入可视（块）模式，`:` 进入命令模式。

因为你会在使用 Vim 时大量使用 `<ESC>` 键，所以可以考虑把大小写锁定键重定义成 `<ESC>` 键或者创建一个[其他的映射](https://vim.fandom.com/wiki/Avoid_the_escape_key#Mappings)通过简单的按键序列来代替 `<ESC>`。

## 基本操作

### 插入文本

在正常模式，键入 `i` 进入插入模式。现在 Vim 跟很多其他的编辑器一样，直到你键入 `<ESC>` 返回正常模式。你只需要掌握这一点和上面介绍的所有基础知识就可以使用 Vim 来编辑文件了 （虽然如果你一直停留在插入模式内不一定高效）。

### 缓存， 标签页， 窗口

Vim 会维护一系列打开的文件，称为“缓存”。一个 Vim 会话包含一系列标签页，每个标签页包含 一系列窗口（分隔面板）。每个窗口显示一个缓存。跟网页浏览器等其他你熟悉的程序不一样的是， 缓存和窗口不是一一对应的关系；窗口只是缓冲区的视图。一个缓存可以在 *多个* 窗口打开，甚至在同一 个标签页内的多个窗口打开。这个功能其实很好用，比如可以查看同一个文件的不同部分。

Vim 默认打开一个标签页，这个标签也包含一个窗口。

**Summary：Vim会话 -> 标签页 -> 窗口（分隔面板） -> 缓存(打卡的文件)**

### 命令行

在正常模式下键入 `:` 进入命令行模式。 在键入 `:` 后，你的光标会立即跳到屏幕下方的命令行。 这个模式有很多功能，包括打开，保存，关闭文件，以及退出 Vim。

- `:q` 退出（关闭窗口）
- `:w` 保存（写）
- `:wq` 保存然后退出
- `:e {文件名}` 打开要编辑的文件
- `:ls` 显示打开的缓存
- `:help {标题}` 打开帮助文档
  - `:help :w` 打开 `:w` 命令的帮助文档
  - `:help w` 打开 `w` 移动的帮助文档



## Vim 的接口其实是一种编程语言

Vim 最重要的设计思想是 Vim 的界面本身是一个程序语言。键入操作（以及他们的助记名） 本身是命令，这些命令可以组合使用。这使得移动和编辑更加高效，特别是一旦形成肌肉记忆。

### 移动

多数时候你会在正常模式下，使用移动命令在缓存中导航。在 Vim 里面移动也被称为 “名词”， 因为它们指向文字块。

- 基本移动: `hjkl` （左， 下， 上， 右）

- 词： `w` （下一个词）， `b` （词初）， `e` （词尾）

- 行： `0` （行初）， `^` （第一个非空格字符）， `$` （行尾）

- 屏幕： `H` （屏幕首行）， `M` （屏幕中间）， `L` （屏幕底部）

- 翻页： `Ctrl-u` （上翻）， `Ctrl-d` （下翻）

- 文件： `gg` （文件头）， `G` （文件尾）

- 行数： `:{行数}<CR>` 或者 `{行数}G` ({行数}为行数)

- 杂项： `%` （找到配对，比如括号或者 /* */ 之类的注释对）

- 查找：`f{字符}`， `t{字符}`， `F{字符}`， `T{字符}`

  - 查找在本行的{字符}

    | 命令        | 查找方向 | 光标停止位置                 | 助记词             |
    | :---------- | :------- | :--------------------------- | :----------------- |
    | **f**{字符} | 正向 →   | **在**目标字符上             | **f**ind           |
    | **t**{字符} | 正向 →   | 到目标字符**前** (Un**t**il) | **t**o / un**t**il |
    | **F**{字符} | 反向 ←   | **在**目标字符上             | **F**ind (反向)    |
    | **T**{字符} | 反向 ←   | 到目标字符**后**             | **T**o (反向)      |

  - `,` / `;` 用于导航匹配

- 搜索: `/{正则表达式}`, `n` / `N` 用于导航匹配



### 选择

**可视化模式**

| 模式               | 进入命令      | 用途               | 选择形状           |
| :----------------- | :------------ | :----------------- | :----------------- |
| **字符可视化模式** | `v`           | **选择连续的字符** | 一片连续的文本区域 |
| **行可视化模式**   | `V` (Shift+v) | **选择整行**       | 一个或多个整行     |
| **块可视化模式**   | `Ctrl-v`      | **选择矩形列块**   | 一个矩形文本块     |

**可以用移动命令来选中。**

#### 1. 直观的文本选择与操作

这是最根本的用途。当你进入可视化模式后，你可以用任何移动光标的命令（`h`, `j`, `k`, `l`, `w`, `b`, `f`, `$`, `gg`, `G` 等）来精确地控制选择范围。选中后，你可以直接进行操作，比如：

- **`d`** 或 **`x`**：删除选中文本 (Cut)
- **`y`**：复制选中文本 (Yank/Copy)
- **`c`**：删除选中文本并进入插入模式 (Change)
- **`~`**：切换选中文本的大小写
- **`u`**：将选中文本变为小写
- **`U`**：将选中文本变为大写
- **`>`**：向右缩进选中文本
- **`<`**：向左缩进选中文本
- **`:`**：对选中的范围执行命令

**例子**：在一段代码中，你想删除一个函数调用的参数。你可以将光标放在第一个参数上，按 `v` 进入可视化模式，然后用 `e` 等移动命令精确选中所有参数，最后按 `d` 删除。这比计算要按多少次 `dw` 要直观和准确得多。

#### 2. 列块操作 (Visual-Block Mode) - 杀手级功能

这是其他很多编辑器都不具备的超级功能。它允许你选择一个**矩形区块**的文本，而不是连续的行。

**典型场景**：

- **同时编辑多行**：在代码中，给多行变量同时添加或修改前缀、后缀。
- **插入文本到多行开头/末尾**：比如同时给多行代码添加注释符 (`//`, `#`)。
- **替换一列字符**：比如修改一个表格数据中的某一列。

**例子**：你有以下几行代码，想要同时给三个变量加上 `m_` 前缀：

```tex
name;
age;
address;
```

1. 将光标放在第一个 `n` 上。

2. 按 `Ctrl-v` 进入**可视化块模式**。

3. 按 `jj` 向下选中三行的第一列。

4. 按 `I`（大写 i），这时你只会看到第一行在闪烁。

5. 输入 `m_`。

6. 按 `Esc`，神奇的事情发生了：三行的开头都同时加上了 `m_`。

   ```tex
   m_name;
   m_age;
   m_address;
   ```

#### 3. 与操作符结合，实现“选择即操作”

可视化模式完美地融入了 Vim“动词+名词”的哲学。你不需要先想好要执行什么操作，而是可以先**选择**（名词），再决定**操作**（动词）。这非常符合直觉。

**传统方式（操作符 + 移动）**：`d}`（删除到段落结尾）。你需要预先知道要用 `d` 和 `}`。
**可视化模式**：`v}` `d`。你可以先看到你到底选了什么，确认无误后，再按下 `d` 执行删除。这减少了误操作的可能。

#### 4. 查看选择的确切范围，避免误操作

在执行一个可能出错的删除或修改操作前，先进入可视化模式确认选择范围是一个非常好的习惯。你可以清晰地看到高亮区域是否完全符合你的预期，如果选多了或选少了，可以轻松地用移动命令调整，然后再执行操作。



### 编辑

所有你需要用鼠标做的事， 你现在都可以用键盘：采用编辑命令和移动命令的组合来完成。 这就是 Vim 的界面开始看起来像一个程序语言的时候。Vim 的编辑命令也被称为 “动词”， 因为动词可以施动于名词。

- `i`进入插入模式
  - 但是对于操纵/编辑文本，不单想用退格键完成
- `O` / `o` 在之上/之下插入行
- `d{移动命令}`删除 {移动命令}
  - 例如，`dw` 删除词, `d$` 删除到行尾, `d0` 删除到行头。
- `c{移动命令}`改变 {移动命令}
  - 例如，`cw` 改变词
  - 比如 `d{移动命令}` 再 `i`
- `x` 删除字符（等同于 `dl`）
- `s` 替换字符（等同于 `xi`）
- 可视化模式 + 操作
  - 选中文字, `d` 删除 或者 `c` 改变
- `u` 撤销, `<C-r>` 重做
- `y` 复制 / “yank” （其他一些命令比如 `d` 也会复制）
- `p` 粘贴
- 更多值得学习的: 比如 `~` 改变字符的大小写